<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ramadan Planner Dashboard</title>
  <style>
    body {
      font-family: 'Lora', serif;
      padding: 30px;
      background: linear-gradient(135deg, #f5f7fa 0%, #e0f2e9 100%);
      color: #2f4f4f;
      margin: 0;
    }
    h1 {
      color: #d4a017;
      text-align: center;
      font-size: 36px;
      text-shadow: 0 2px 6px rgba(212, 160, 23, 0.4);
      margin-bottom: 20px;
      position: relative;
    }
    h1::before {
      content: "âœ¨";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: -20px;
      font-size: 24px;
      color: #d4a017;
    }
    .date-time {
      text-align: center;
      margin-bottom: 30px;
      font-size: 18px;
      color: #fff;
      background: linear-gradient(90deg, #2e7d32 0%, #4caf50 100%);
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      font-family: 'Roboto', sans-serif;
    }
    .verse-box {
      background: #fff;
      padding: 25px;
      margin-bottom: 40px;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      border: 2px solid #e6f0ea;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
    }
    .verse-box::before {
      content: "ðŸ•‹";
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      color: #2e7d32;
      opacity: 0.2;
    }
    .verse-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(46, 125, 50, 0.15);
    }
    .verse-box h2 {
      color: #2e7d32;
      font-size: 24px;
      margin-top: 0;
      border-bottom: 2px dashed #d4a017;
      padding-bottom: 10px;
    }
    .leaderboard-container {
      width: 80%;
      max-width: 700px;
      margin: 0 auto;
      position: relative;
    }
    .leaderboard {
      width: 100%;
      border-collapse: collapse;
      background: linear-gradient(180deg, #fff 0%, #fafafa 100%);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    .leaderboard th {
      background: linear-gradient(90deg, #d4a017 0%, #b8860b 100%);
      color: #fff;
      padding: 15px 20px;
      font-size: 20px;
      text-align: left;
      border-bottom: 3px solid #2e7d32;
      font-family: 'Lora', serif;
    }
    .leaderboard td {
      padding: 15px 20px;
      color: #2f4f4f;
      border-bottom: 1px solid #e6f0ea;
      transition: background-color 0.3s ease;
      font-family: 'Roboto', sans-serif;
    }
    .leaderboard tr {
      background: #fff;
    }
    .leaderboard tr:hover {
      background: #f0f7f2;
      cursor: pointer;
    }
    .leaderboard tr:nth-child(1) td {
      background: rgba(212, 160, 23, 0.2);
      font-weight: bold;
      color: #d4a017;
    }
    .leaderboard td:first-child::before {
      content: "ðŸŒ™";
      margin-right: 10px;
      color: #2e7d32;
      transition: transform 0.3s ease;
    }
    .leaderboard tr:hover td:first-child::before {
      transform: scale(1.2);
    }
    .refresh-btn, .begin-btn {
      display: inline-block;
      margin: 20px 15px;
      padding: 12px 25px;
      background: linear-gradient(90deg, #2e7d32 0%, #4caf50 100%);
      color: #fff;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      font-family: 'Roboto', sans-serif;
    }
    .refresh-btn:hover, .begin-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(46, 125, 50, 0.5);
    }
    .alert {
      color: #c62828;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      font-size: 16px;
      background: #ffebee;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(198, 40, 40, 0.2);
      animation: fadeIn 1s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes glow {
      from { text-shadow: 0 2px 4px rgba(212, 160, 23, 0.3); }
      to { text-shadow: 0 2px 8px rgba(212, 160, 23, 0.5); }
    }
  </style>
</head>
<body>
  <h1>Ramadan Planner Dashboard</h1>
  
  <div class="date-time" id="dateTime">
    <p><strong>Today:</strong> <span id="gregorian"></span></p>
    <p><strong>Hijri Date:</strong> <span id="hijri"></span></p>
  </div>
  
  <div class="verse-box" id="verseBox">
    <h2>Daily Inspiration from the Quran</h2>
    <p><strong>Verse:</strong> <span id="verse"></span></p>
    <p><strong>Meaning:</strong> <span id="meaning"></span></p>
  </div>
  
  <div class="leaderboard-container">
    <h2>Salah Leaderboard</h2>
    <table class="leaderboard" id="leaderboard">
      <tr><th>Twitter Handle</th><th>Salah Score</th></tr>
    </table>
    <button class="refresh-btn" onclick="refreshLeaderboard()">Refresh Rankings</button>
    <button class="begin-btn" onclick="beginPlanning()">Begin Planning</button>
  </div>
  
  <div id="alert" class="alert" style="display: none;"></div>

  <script>
    // Quran verses (static array)
    const verses = [
      { verse: "Indeed, with hardship comes ease (94:6)", meaning: "Allah promises relief after every difficulty." },
      { verse: "So remember Me; I will remember you (2:152)", meaning: "Remembrance of Allah brings His mercy and closeness." },
      { verse: "And whoever fears Allah - He will make for him a way out (65:2)", meaning: "Taqwa opens doors to solutions." },
      { verse: "Allah does not burden a soul beyond that it can bear (2:286)", meaning: "You are stronger than you think with Allahâ€™s decree." },
      { verse: "The life of this world is but a fleeting enjoyment (3:185)", meaning: "Focus on the eternal, not the temporary." },
      { verse: "Call upon Me; I will respond to you (40:60)", meaning: "Allah is always near, ready to answer your duâ€™a." },
      { verse: "And We have certainly made the Quran easy for remembrance (54:17)", meaning: "The Quran is accessible to all who seek it." },
      { verse: "And He found you lost and guided you (93:7)", meaning: "Allahâ€™s guidance is a gift to the seeking heart." },
      { verse: "Indeed, the mercy of Allah is near to the doers of good (7:56)", meaning: "Good deeds draw you closer to Allahâ€™s rahmah." },
      { verse: "So be patient. Indeed, the promise of Allah is truth (30:60)", meaning: "Trust in Allahâ€™s timing and promises." },
      { verse: "And whoever puts his trust in Allah, He will suffice him (65:3)", meaning: "Reliance on Allah is enough for all needs." },
      { verse: "Indeed, in the remembrance of Allah do hearts find rest (13:28)", meaning: "Peace comes through dhikr." },
      { verse: "And your Lord is the Forgiving, Full of Mercy (18:58)", meaning: "Allahâ€™s forgiveness is vast and ever-present." },
      { verse: "Say, â€˜My prayer, my sacrifice, my living, and my dying are for Allahâ€™ (6:162)", meaning: "Dedicate your life to Allah alone." },
      { verse: "And the Hereafter is better for you than the first life (93:4)", meaning: "The eternal reward surpasses this world." },
      { verse: "Indeed, Allah is with the patient (2:153)", meaning: "Patience brings Allahâ€™s companionship." },
      { verse: "And We send down of the Quran that which is healing and mercy (17:82)", meaning: "The Quran heals the heart and soul." },
      { verse: "Whoever does righteousness, it is for his own soul (41:46)", meaning: "Good deeds benefit you first." },
      { verse: "And seek help through patience and prayer (2:45)", meaning: "Strength lies in sabr and salah." },
      { verse: "Indeed, those who have believed and done righteous deeds - the Most Merciful will appoint for them affection (19:96)", meaning: "Faith and good deeds earn Allahâ€™s love." },
      { verse: "My mercy encompasses all things (7:156)", meaning: "Allahâ€™s rahmah is limitless." },
      { verse: "And do good; indeed, Allah loves the doers of good (2:195)", meaning: "Kindness is beloved to Allah." },
      { verse: "Indeed, the decree of Allah is always destined (15:21)", meaning: "Everything happens by Allahâ€™s perfect plan." },
      { verse: "And whoever turns away from My remembrance - indeed, he will have a depressed life (20:124)", meaning: "Nearness to Allah brings happiness." },
      { verse: "Indeed, Allah is the best of providers (62:11)", meaning: "Trust Allah for your sustenance." },
      { verse: "And We have not sent you except as a mercy to the worlds (21:107)", meaning: "The Prophet (PBUH) is a blessing for all." },
      { verse: "So whoever does an atomâ€™s weight of good will see it (99:7)", meaning: "No good deed is too small for reward." },
      { verse: "And whoever is grateful - his gratitude is only for his own good (27:40)", meaning: "Shukr benefits the thankful." },
      { verse: "Indeed, the righteous will be in pleasure (83:22)", meaning: "Righteousness leads to eternal joy." },
      { verse: "And Allah is the best of planners (3:54)", meaning: "Allahâ€™s plans always prevail." }
    ];

    // Date and time display with corrected Hijri (Bangladesh time)
    function updateDateTime() {
      const now = new Date();
      const bangladeshTime = new Date(now.getTime() + (6 * 60 * 60 * 1000));
      document.getElementById('gregorian').textContent = bangladeshTime.toLocaleString('en-US', {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
        hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true,
        timeZone: 'UTC'
      });

      // Hijri date aligned to Ramadan start (March 1, 2025, 18:00 UTC = March 2, 00:00 BDT = 1 Ramadan 1446 AH)
      const ramadanStart = new Date('2025-03-01T18:00:00Z');
      const ramadanStartBangladesh = new Date(ramadanStart.getTime() + (6 * 60 * 60 * 1000));
      const timeDiff = bangladeshTime - ramadanStartBangladesh;
      const daysSinceRamadanStart = Math.floor(timeDiff / (1000 * 60 * 60 * 24)) + 1;
      document.getElementById('hijri').textContent = `${daysSinceRamadanStart} Ramadan 1446 AH`;
    }

    // Display daily verse
    function updateVerse() {
      const now = new Date();
      const bangladeshTime = new Date(now.getTime() + (6 * 60 * 60 * 1000));
      const ramadanDay = (bangladeshTime.getDate() - 2) % 30; // Adjust for 0-based index starting March 2
      const verse = verses[ramadanDay];
      document.getElementById('verse').textContent = verse.verse;
      document.getElementById('meaning').textContent = verse.meaning;
    }

    // Check submission window (Bangladesh time)
    function isSubmissionWindowOpen() {
      const now = new Date();
      const bangladeshTime = new Date(now.getTime() + (6 * 60 * 60 * 1000));
      const hours = bangladeshTime.getUTCHours();
      const isOpen = (hours >= 18 || hours < 4);
      document.getElementById('alert').textContent = isOpen ? '' : 'Form submissions are only accepted between 6 PM and 4 AM daily.';
      document.getElementById('alert').style.display = isOpen ? 'none' : 'block';
      return isOpen;
    }

    // Fetch leaderboard from Apps Script proxy
    async function refreshLeaderboard() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbyUTQI4buNwCEOY0imN1LzePF7SwnQMtxIY1FXyYLRj4Q2vDuaHNalPJeWs1mqzXHHv/exec'); // Replace with your Apps Script URL
        if (!response.ok) throw new Error('Fetch failed: ' + response.status);
        const data = await response.json();
        console.log('Leaderboard data:', data); // Debug log
        const table = document.getElementById('leaderboard');
        while (table.rows.length > 1) table.deleteRow(1);
        data.forEach((entry, index) => {
          const row = table.insertRow();
          row.innerHTML = `<td>${entry.twitter}</td><td>${entry.score}</td>`;
          if (index === 0) {
            row.style.background = 'rgba(212, 160, 23, 0.2)';
            row.style.fontWeight = 'bold';
            row.style.color = '#d4a017';
          }
        });
      } catch (error) {
        console.error('Leaderboard error:', error);
        document.getElementById('leaderboard').innerHTML = '<tr><td colspan="2">Error loading leaderboard</td></tr>';
      }
    }

    // Redirect to form
    function beginPlanning() {
      window.location.href = 'https://forms.gle/MFrhkGw7qPFYp6uv8';
    }

    // Initialize
    updateDateTime();
    updateVerse();
    isSubmissionWindowOpen();
    refreshLeaderboard();
    setInterval(updateDateTime, 1000);
  </script>
</body>
</html>
